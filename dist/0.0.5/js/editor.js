(function(){var e,n;window.editor=ace.edit("editor"),n=document.getElementById("file_manager"),window.combine_path=function(e,a){return n.combine(e,a)},window.prompt_file_name=function(){var e,a;return e=prompt(""+chrome.i18n.getMessage("create_file")+" "+window.storage.path+"/"),e&&""!==e.trim()?n.valid_name(e)?(a=""+window.storage.path+"/"+e,n.exists(a)?(window.notice(chrome.i18n.getMessage("already_exists"),a),!1):a):(window.notice(chrome.i18n.getMessage("invalid_path_name"),e),!1):!1},window.save_file=function(){var e;if(window.storage.file)return e=n.write(window.storage.file,editor.getValue()),e?(window.notice(chrome.i18n.getMessage("saved"),window.storage.file),document.title=""+n.filename(window.storage.file)+" - Slim Text"):alert(""+chrome.i18n.getMessage("unable_to_save")+" "+window.storage.file);if(window.storage.file=window.prompt_file_name(),window.storage.file)return window.save_file(),window.show_sidebar(window.storage.path)},window.create_file=function(){var e;return(e=window.prompt_file_name())?(n.write(e,""),window.open_path(e)):void 0},window.create_folder=function(){var e,a;return e=prompt(""+chrome.i18n.getMessage("create_folder")+" "+window.storage.path+"/"),e&&""!==e.trim()?n.valid_name(e)?(a=""+window.storage.path+"/"+e,n.exists(a)?window.notice(chrome.i18n.getMessage("already_exists"),a):(n.create_folder(a),window.show_sidebar(window.storage.path))):window.notice(chrome.i18n.getMessage("invalid_path_name"),e):void 0},window.show_breadcrumb=function(e){var a,t,s,i,o,r,l,d,c,g,w,p,h;if($("#route").empty(),r=n.route(e),r.reverse(),-1!==navigator.appVersion.indexOf("Windows")){if(s=_.first(r),r=_.rest(r),l=_.first(r),l&&(l.name=s.name),0===r.length){for(t=$('<select id="drives_select"></select>'),p=n.drives(),d=0,g=p.length;g>d;d++)a=p[d],t.append('<option value="'+a+'">'+a.substr(0,a.length-1)+"</option>");t.val(s.name.toUpperCase()+"/"),$("#route").append(t)}}else 0===r.length&&$("#route").append("/");for(h=_.initial(r),c=0,w=h.length;w>c;c++)i=h[c],o=$('<a class="file-link">'+i.name+"</a>"),o.data("path",i.path),$("#route").append(o),"/"===i.name?$("#route").append(" "):$("#route").append(" / ");return i=_.last(r),i?$("#route").append(""+i.name):void 0},e=function(e){var a;return"file"===e.type&&(a=n.extension(e.name),a.length>0&&(a=a.toLowerCase().substr(1,a.length-1),window.is_binary(a)))?!1:!0},window.show_sidebar=function(a){var t,s,i,o,r,l;for($("#sidebar").empty(),s=n.list(a),s=_.sortBy(s,function(e){return e.name.toLowerCase()}),l=[],o=0,r=s.length;r>o;o++)t=s[o],t.path===window.storage.file?$("#sidebar").append('<span class="current">'+t.name+"</span>"):e(t)?(i=$('<a class="file-link">'+t.name+"</a>"),i.data("path",t.path),$("#sidebar").append(i),"folder"===t.type&&$("#sidebar").append("/")):$("#sidebar").append("<span>"+t.name+"</span>"),l.push($("#sidebar").append("<br/>"));return l},window.add_topbar=function(){var e,n,a,t,s,i,o,r,l,d,c,g;for($(".ui-layout-resizer-north").append('<div id="navbar">\n  <span class="dropdown">\n    <a class="dropdown-toggle" data-toggle="dropdown">\n      '+chrome.i18n.getMessage("file")+'\n      <b class="caret"></b>\n    </a>\n    <ul class="dropdown-menu">\n        <li><a class="new_file_btn">'+chrome.i18n.getMessage("new_file")+'</a></li>\n        <li><a class="new_folder_btn">'+chrome.i18n.getMessage("new_folder")+'</a></li>\n        <li><a class="save_btn">'+chrome.i18n.getMessage("save")+'</a></li>\n    </ul>\n  </span>\n  <span class="dropdown">\n    <a class="dropdown-toggle" data-toggle="dropdown">\n      '+chrome.i18n.getMessage("edit")+'\n      <b class="caret"></b>\n    </a>\n    <ul class="dropdown-menu">\n      <li><a class="indent_btn">'+chrome.i18n.getMessage("indent")+'</a></li>\n      <li><a class="outdent_btn">'+chrome.i18n.getMessage("outdent")+'</a></li>\n      <li><a class="lower_case_btn">'+chrome.i18n.getMessage("lower_case")+'</a></li>\n      <li><a class="upper_case_btn">'+chrome.i18n.getMessage("upper_case")+'</a></li>\n      <li><a class="remove_lines_btn">'+chrome.i18n.getMessage("remove_lines")+'</a></li>\n      <li><a class="toggle_comment_btn">'+chrome.i18n.getMessage("toggle_comment")+'</a></li>\n    </ul>\n  </span>\n  <span class="dropdown">\n    <a class="dropdown-toggle" data-toggle="dropdown">\n      '+chrome.i18n.getMessage("search")+'\n      <b class="caret"></b>\n    </a>\n    <ul class="dropdown-menu">\n      <li><a class="find_btn">'+chrome.i18n.getMessage("find")+'</a></li>\n      <li><a class="replace_btn">'+chrome.i18n.getMessage("replace")+'</a></li>\n    </ul>\n  </span>\n  <span class="dropdown">\n    <a class="dropdown-toggle" data-toggle="dropdown">\n      '+chrome.i18n.getMessage("view")+'\n      <b class="caret"></b>\n    </a>\n    <ul class="dropdown-menu">\n        <li class="dropdown-submenu">\n            <a>'+chrome.i18n.getMessage("syntax")+'</a>\n            <ul class="dropdown-menu" id="mode_list"></ul>\n        </li>\n        <li><a class="toggle_word_wrap_btn">'+chrome.i18n.getMessage("toggle_word_wrap")+'</a></li>\n        <li><a class="toggle_invisibles_btn">'+chrome.i18n.getMessage("toggle_invisibles")+'</a></li>\n        <li><a class="full_window_btn">'+chrome.i18n.getMessage("full_window")+'</a></li>\n    </ul>\n  </span>\n  <span class="dropdown">\n    <a class="dropdown-toggle" data-toggle="dropdown">\n      '+chrome.i18n.getMessage("preferences")+'\n      <b class="caret"></b>\n    </a>\n    <ul class="dropdown-menu">\n        <li><a class="options_btn">'+chrome.i18n.getMessage("options")+'</a></li>\n    </ul>\n  </span>\n  <span class="dropdown">\n    <a class="dropdown-toggle" data-toggle="dropdown">\n      '+chrome.i18n.getMessage("help")+'\n      <b class="caret"></b>\n    </a>\n    <ul class="dropdown-menu">\n        <li><a href="https://github.com/ajaxorg/ace/wiki/Default-Keyboard-Shortcuts" target="_blank">'+chrome.i18n.getMessage("keyboard_shortcuts")+'</a></li>\n        <li><a href="http://slimtext.org" target="_blank">'+chrome.i18n.getMessage("website")+'</a></li>\n        <li><a href="https://github.com/tylerlong/slimtext.org/issues" target="_blank">'+chrome.i18n.getMessage("report_issue")+'</a></li>\n        <li><a class="check_for_updates_btn">'+chrome.i18n.getMessage("check_for_updates")+'</a></li>\n        <li><a class="about_btn">'+chrome.i18n.getMessage("about")+' Slim Text</a></li>\n    </ul>\n  </span>\n</div>\n<div id="toolbar">\n<a class="new_file_btn" title="'+chrome.i18n.getMessage("new_file")+'"><i class="icon-file"></i></a>\n<a class="new_folder_btn" title="'+chrome.i18n.getMessage("new_folder")+'"><i class="icon-folder-close-alt"></i></a>\n<a class="save_btn" title="'+chrome.i18n.getMessage("save")+'"><i class="icon-save"></i></a>\n<a class="find_btn" title="'+chrome.i18n.getMessage("find")+'"><i class="icon-search"></i></a>\n<a class="toggle_invisibles_btn" title="'+chrome.i18n.getMessage("toggle_invisibles")+'"><i class="icon-eye-open"></i></a>\n<a class="indent_btn" title="'+chrome.i18n.getMessage("indent")+'"><i class="icon-indent-right"></i></a>\n<a class="outdent_btn" title="'+chrome.i18n.getMessage("outdent")+'"><i class="icon-indent-left"></i></a>\n<a class="full_window_btn" title="'+chrome.i18n.getMessage("full_window")+'"><i class="icon-fullscreen"></i></a>\n<a class="options_btn" title="'+chrome.i18n.getMessage("options")+'"><i class="icon-cog"></i></a>\n<a class="check_for_updates_btn" title="'+chrome.i18n.getMessage("check_for_updates")+'"><i class="icon-cloud-download"></i></a>\n<a title="'+chrome.i18n.getMessage("report_issue")+'" href="https://github.com/tylerlong/slimtext.org/issues" target="_blank"><i class="icon-github-alt"></i></a>\n<a class="about_btn" title="'+chrome.i18n.getMessage("about")+' Slim Text"><i class="icon-info-sign"></i></a>\n<i class="icon-fullscreen" id="hidden_btn"></i>\n</div>'),o=[["a","d"],["e","j"],["k","o"],["p","s"],["t","z"]],s=[],r=0,d=o.length;d>r;r++)i=o[r],$("#mode_list").append('<li class="dropdown-submenu">\n    <a>'+i[0].toUpperCase()+" - "+i[1].toUpperCase()+'</a>\n    <ul class="dropdown-menu" id="'+i[0]+"_to_"+i[1]+'"></ul>\n</li>'),s.push([RegExp("^["+i[0]+"-"+i[1]+"]","i"),"#"+i[0]+"_to_"+i[1]]);g=window.modes;for(n in g)for(a=g[n],e='<li><a data-mode="'+n+'" class="mode-link">'+a+"</a></li>",l=0,c=s.length;c>l;l++)if(t=s[l],a.match(t[0])){$(t[1]).append(e);break}return window.layout.allowOverflow($(".ui-layout-resizer-north")),window.layout.state.north.isClosed?($("#navbar").hide(),$("#toolbar").hide()):void 0},window.open_path=function(e){var a,t,s,i,o,r,l,d,c;{if(n.exists(e)){if(r=n.type(e),"file"===r){if(0===document.title.indexOf("* ")&&!confirm('"'+window.storage.file+'" '+chrome.i18n.getMessage("save_before_leaving")))return;window.storage.file=e,a=n.read(e),editor.session.setValue(a,-1),s=n.filename(e),document.title=""+s+" - Slim Text",t=n.extension(s),t?(t=t.toLowerCase().substr(1,t.length-1),editor.getSession().setMode(window.guess_mode_by_extension(t))):editor.getSession().setMode(window.guess_mode_by_name(s)),e=n.container(e)}return n.can_list(e)||(window.notice(chrome.i18n.getMessage("permission_denied"),e),e=n.home_folder()||n.temp_folder()),window.storage.path=e,show_breadcrumb(e),show_sidebar(e)}for(window.notice(chrome.i18n.getMessage("does_not_exist"),e),o=n.route(e),c=_.rest(o),l=0,d=c.length;d>l;l++)if(i=c[l],n.exists(i.path))return window.open_path(i.path),void 0}},$(function(){return chrome.storage.local.get(["path","file"],function(e){var a;return a=e.file||e.path||n.home_folder()||n.temp_folder(),window.storage={file:e.file,path:a},open_path(a),a=e.path||n.home_folder()||n.temp_folder(),open_path(a)}),chrome.storage.sync.get(["theme","font_size","key_binding","tab_size"],function(e){return e.theme||(e.theme="monokai"),e.font_size||(e.font_size="12"),e.key_binding||(e.key_binding="ace"),e.tab_size||(e.tab_size=4),editor.setTheme("ace/theme/"+e.theme),editor.setFontSize(""+e.font_size+"px"),editor.getSession().setTabSize(e.tab_size),"vim"===e.key_binding?editor.setKeyboardHandler(ace.require("ace/keyboard/vim").handler):"emacs"===e.key_binding?editor.setKeyboardHandler(ace.require("ace/keyboard/emacs").handler):void 0}),window.layout=$("body").layout({spacing_closed:5,stateManagement__enabled:!0,north:{slidable:!1,spacing_open:15,size:18,resizable:!1,togglerLength_open:0,togglerTip_closed:chrome.i18n.getMessage("exit_full_window"),onopen_start:function(){return window.layout.open("west"),$("#navbar").show(),$("#toolbar").show(),window.editor.focus()},onclose_start:function(){return window.layout.close("west"),$("#navbar").hide(),$("#toolbar").hide(),window.editor.focus()}},west:{spacing_open:5,livePaneResizing:!0,size:128,togglerLength_open:0,togglerLength_closed:0,slideTrigger_open:"mouseover",resizerTip:chrome.i18n.getMessage("resize")},center:{onresize_end:function(){return editor.resize()}}}),window.add_topbar()})}).call(this);