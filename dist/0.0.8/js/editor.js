(function(){this.Editor=function(){function e(e){this.path=e,this.uid=_.uniqueId(),this.tabs=$("#tabs").tabs(),this.create_tab(),this.create_editor(),this.load_content(),this.bind_event()}return e.prototype.create_tab=function(){var e,t;return e=$('<div id="tab-'+this.uid+'"><div id="editor-'+this.uid+'"></div></div>'),e.data("path",this.path),e.data("uid",this.uid),$("#tabs").append(e),this.filename=file_manager.filename(this.path),t=$('<li id="li-'+this.uid+'" title="'+this.path+'"><a id="link-'+this.uid+'" href="#tab-'+this.uid+'">'+this.filename+'</a> <span class="ui-icon ui-icon-close">x</span></li>'),t.appendTo("#tabs .ui-tabs-nav"),this.tabs.tabs("refresh"),this.tabs.tabs("option","active",-1)},e.prototype.create_editor=function(){var e;return this.editor=ace.edit("editor-"+this.uid),e=this.editor,chrome.storage.sync.get(["theme","font_size","key_binding","tab_size"],function(t){return t.theme||(t.theme="monokai"),t.font_size||(t.font_size="13"),t.key_binding||(t.key_binding="ace"),t.tab_size||(t.tab_size=4),e.setTheme("ace/theme/"+t.theme),e.setFontSize(""+t.font_size+"px"),e.getSession().setTabSize(t.tab_size),t.key_binding==="vim"?e.setKeyboardHandler(ace.require("ace/keyboard/vim").handler):t.key_binding==="emacs"?e.setKeyboardHandler(ace.require("ace/keyboard/emacs").handler):void 0})},e.prototype.load_content=function(){var e,t;return e=file_manager.read(this.path),this.editor.session.setValue(e,-1),t=file_manager.extension(this.filename),t?(t=t.toLowerCase().substr(1,t.length-1),this.editor.getSession().setMode(mode.guess_mode_by_extension(t))):this.editor.getSession().setMode(mode.guess_mode_by_name(this.filename))},e.prototype.bind_event=function(){var e,t;return t=this.uid,e=_.debounce(function(){return $("#link-"+t).text().indexOf("* ")!==0?$("#link-"+t).text("* "+$("#link-"+t).text()):void 0},500,!0),this.editor.getSession().on("change",function(){return e()})},e.prototype.save_file=function(){var e,t;return t=file_manager.write(this.path,this.editor.getValue()),t?(e=$("a#link-"+this.uid),e.text().indexOf("* ")===0?e.text(e.text().substr(2)):void 0):util.notice(chrome.i18n.getMessage("unable_to_save"),this.path)},e.prototype.dispose=function(){var e;return e=$("#link-"+this.uid).text(),e.indexOf("* ")!==0||confirm('"'+e.substr(2)+'" '+chrome.i18n.getMessage("save_before_leaving"))?(this.editor.destroy(),$("li[aria-controls='tab-"+this.uid+"']").remove(),$("#tab-"+this.uid).remove(),this.tabs.tabs("refresh"),delete editors[this.uid],application.refresh_sidebar()):void 0},e}()}).call(this);